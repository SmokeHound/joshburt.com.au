<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Admin Dashboard</title>
  <link rel="manifest" href="./manifest.json" />
  <link rel="apple-touch-icon" href="./assets/images/logo-placeholder.svg" />
  <link rel="stylesheet" href="./assets/css/styles.css" />
    <script src="./assets/js/init-shared.js" defer></script>
    <script src="./assets/js/audit.js" defer></script>
    <script src="./assets/js/feature-flags.js" defer></script>
  <style>
    .sidebar{transition:transform .3s ease-in-out}
  </style>
</head>
<body class="dark">
    <!-- Toast Notification -->
    
    <!-- Mobile Menu Toggle -->
    <button id="menu-toggle" class="md:hidden fixed top-4 left-4 z-50 p-2 bg-primary text-white rounded-md focus:outline-none focus:ring-2 focus:ring-secondary" aria-label="Toggle sidebar" aria-expanded="false">☰</button>
    <div id="sidebar-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>
    <div class="flex flex-col md:flex-row min-h-screen">
        <!-- Sidebar -->
        <!-- Shared Navigation Placeholder -->
        <div id="main-nav"></div>
        <!-- Load shared navigation dynamically -->
        <script>
            fetch('shared-nav.html')
                .then(r => r.text())
                .then(html => {
                    document.getElementById('main-nav').innerHTML = html;
                    // Call the function to highlight the active nav link after insertion
                    if (window.setActiveNavLink) window.setActiveNavLink();
                });
        </script>
        <!-- Main Content -->
    <!-- Main Content -->
    <main id="main-content" class="flex-1 p-4" role="main">
        <!-- Sticky Header -->
    <header class="page-header card border">
            <h2 class="text-3xl font-bold text-white" id="welcome-message">Welcome, Admin!</h2>
            <p class="text-lg mt-2 nav-link-muted">Administrative Dashboard & Controls</p>
        </header>

        <!-- Content Section -->
        <section aria-label="Administrative functions" class="space-y-6">
            <p class="mb-6 leading-relaxed nav-link-muted">This is your dashboard. Here you can manage users, view site analytics, and perform administrative tasks.</p>

            <!-- Admin Cards Grid with More Than 3 Colors -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" role="region" aria-label="Admin functions">
                <div class="card widget-primary p-6 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 bg-gradient-to-r from-blue-600 to-blue-800" tabindex="0" role="article" style="background: linear-gradient(to right, rgb(37, 99, 235), rgb(30, 64, 175)) !important;">
                    <h3 class="text-xl font-semibold mb-3 text-white">User Management</h3>
                    <p class="mb-4 nav-link-muted">Manage user accounts and permissions.</p>
                    <a href="users.html" class="w-full block p-3 text-black rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 text-center transition-colors duration-200 btn-neon-blue">Manage Users</a>
                </div>
                <div class="card widget-secondary p-6 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 bg-gradient-to-r from-green-600 to-green-800" tabindex="0" role="article" style="background: linear-gradient(to right, rgb(22, 163, 74), rgb(21, 128, 61)) !important;">
                    <h3 class="text-xl font-semibold mb-3 text-white">Analytics</h3>
                    <p class="mb-4 nav-link-muted">View site statistics and user engagement.</p>
                    <a href="analytics.html" class="w-full block p-3 text-black rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 text-center transition-colors duration-200 btn-neon-green">View Analytics</a>
                </div>
                <div class="card widget-accent p-6 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 bg-gradient-to-r from-purple-600 to-purple-800" tabindex="0" role="article" style="background: linear-gradient(to right, rgb(147, 51, 234), rgb(107, 33, 168)) !important;">
                    <h3 class="text-xl font-semibold mb-3 text-white">Site Settings</h3>
                    <p class="mb-4 nav-link-muted">Configure website settings and preferences.</p>
                    <a href="settings.html" class="w-full block p-3 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 text-center transition-colors duration-200 btn-neon-purple">Site Settings</a>
                </div>
                <div class="card widget-pink p-6 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 bg-gradient-to-r from-pink-600 to-pink-800" tabindex="0" role="article" style="background: linear-gradient(to right, rgb(219, 39, 119), rgb(157, 23, 77)) !important;">
                    <h3 class="text-xl font-semibold mb-3 text-white">Audit Logs</h3>
                    <p class="mb-4 nav-link-muted">View and review all admin actions and changes.</p>
                    <a href="audit-logs.html" class="w-full block p-3 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 text-center transition-colors duration-200 btn-neon-pink">Audit Logs</a>
                </div>
            </div>

            <!-- Additional Management Cards Row -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-8" role="region" aria-label="Product and Order Management">
                <div class="card widget-primary p-6 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 bg-gradient-to-r from-cyan-600 to-cyan-800" tabindex="0" role="article" style="background: linear-gradient(to right, rgb(8, 145, 178), rgb(21, 94, 117)) !important;">
                    <h3 class="text-xl font-semibold mb-3 text-white">Oil Product Management</h3>
                    <p class="mb-4 nav-link-muted">Add, edit, and manage oil product inventory and details.</p>
                    <a href="oil-products-mgmt.html" class="w-full block p-3 text-black rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 text-center transition-colors duration-200 btn-neon-blue">Oil Products</a>
                </div>
                <div class="card widget-secondary p-6 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 bg-gradient-to-r from-orange-600 to-orange-800" tabindex="0" role="article" style="background: linear-gradient(to right, rgb(234, 88, 12), rgb(154, 52, 18)) !important;">
                    <h3 class="text-xl font-semibold mb-3 text-white">Consumables Management</h3>
                    <p class="mb-4 nav-link-muted">Manage consumables inventory, categories, and stock levels.</p>
                    <a href="consumables-mgmt.html" class="w-full block p-3 text-black rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 text-center transition-colors duration-200 btn-neon-green">Consumables Management</a>
                </div>
                <div class="card widget-accent p-6 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 bg-gradient-to-r from-indigo-600 to-indigo-800" tabindex="0" role="article" style="background: linear-gradient(to right, rgb(79, 70, 229), rgb(55, 48, 163)) !important;">
                    <h3 class="text-xl font-semibold mb-3 text-white">Order Review</h3>
                    <p class="mb-4 nav-link-muted">Review, approve, and track oil and consumables orders.</p>
                    <a href="orders-review.html" class="w-full block p-3 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 text-center transition-colors duration-200 btn-neon-purple">Review Orders</a>
                </div>
            </div>

            <!-- Beta Features Section (Feature Flag Gated) -->
            <div id="beta-features-section" class="hidden mt-8" role="region" aria-label="Beta Features">
                <h3 class="text-xl font-semibold mb-4 text-yellow-400 flex items-center gap-2">
                    <span>⚡</span> Beta Features
                    <span class="text-xs bg-yellow-500 text-black px-2 py-1 rounded">BETA</span>
                </h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="card widget-yellow p-6 rounded-lg shadow-md border-2 border-yellow-500/30" tabindex="0" role="article">
                        <h4 class="text-lg font-semibold mb-3 text-white">AI-Powered Insights</h4>
                        <p class="mb-4 nav-link-muted text-sm">Get intelligent recommendations based on your data patterns.</p>
                        <button class="w-full p-3 bg-yellow-500 text-black rounded-lg hover:bg-yellow-400 transition-colors duration-200 font-semibold" onclick="window.showBetaFeatureNotification('AI Insights')">Try AI Insights</button>
                    </div>
                    <div class="card widget-yellow p-6 rounded-lg shadow-md border-2 border-yellow-500/30" tabindex="0" role="article">
                        <h4 class="text-lg font-semibold mb-3 text-white">Predictive Analytics</h4>
                        <p class="mb-4 nav-link-muted text-sm">Forecast future trends and prepare in advance.</p>
                        <button class="w-full p-3 bg-yellow-500 text-black rounded-lg hover:bg-yellow-400 transition-colors duration-200 font-semibold" onclick="window.showBetaFeatureNotification('Predictive Analytics')">Explore Predictions</button>
                    </div>
                    <div class="card widget-yellow p-6 rounded-lg shadow-md border-2 border-yellow-500/30" tabindex="0" role="article">
                        <h4 class="text-lg font-semibold mb-3 text-white">Advanced Automation</h4>
                        <p class="mb-4 nav-link-muted text-sm">Automate complex workflows and save time.</p>
                        <button class="w-full p-3 bg-yellow-500 text-black rounded-lg hover:bg-yellow-400 transition-colors duration-200 font-semibold" onclick="window.showBetaFeatureNotification('Advanced Automation')">Setup Automation</button>
                    </div>
                </div>
                <p class="mt-4 text-sm text-gray-400 italic">
                    Note: Beta features are experimental and may change. Provide feedback to help us improve!
                </p>
            </div>

            <!-- New Dashboard Section (Feature Flag Gated) -->
            <div id="new-dashboard-section" class="hidden mt-8" role="region" aria-label="New Dashboard">
                <h3 class="text-xl font-semibold mb-4 text-blue-400 flex items-center gap-2">
                    <span>🎨</span> New Dashboard Experience
                    <span class="text-xs bg-blue-500 text-white px-2 py-1 rounded">NEW</span>
                </h3>
                <div class="card widget-primary p-6 rounded-lg shadow-md border-2 border-blue-500/30">
                    <p class="mb-4">Experience our redesigned dashboard with enhanced visualization and better user experience.</p>
                    <a href="shared-dashboards.html" class="inline-block px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200 font-semibold">Launch New Dashboard</a>
                </div>
            </div>
        </section>
    </main>

    <!-- Load shared theme functionality -->
    <script>
        fetch('shared-theme.html')
            .then(response => response.text())
            .then(html => {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;
                const scripts = tempDiv.getElementsByTagName('script');
                for (let script of scripts) {
                    const newScript = document.createElement('script');
                    newScript.textContent = script.textContent;
                    document.body.appendChild(newScript);
                }
            });
    </script>
    </div>
                    <script>
                        // Load and apply site settings
                        function loadAndApplySettings() {
                            const settings = JSON.parse(localStorage.getItem('siteSettings')) || {};
                            // Apply site title if set
                            if (settings['site-title']) {
                                const brandingElements = document.querySelectorAll('h1');
                                brandingElements.forEach(el => el.textContent = settings['site-title']);
                            }
                        }
                        loadAndApplySettings();

                        // Sidebar toggle for mobile
                        function wireMenu() {
                            const menuToggle = document.getElementById('menu-toggle');
                            const sidebar = document.getElementById('sidebar');
                            const sidebarBackdrop = document.getElementById('sidebar-backdrop');
                            if (!(menuToggle && sidebar)) return;
                            // Check if already wired to prevent duplicate listeners
                            if (menuToggle.dataset.wired === 'true') return;
                            menuToggle.dataset.wired = 'true';
                            
                            menuToggle.addEventListener('click', function() {
                                const isOpen = sidebar.classList.toggle('open');
                                this.setAttribute('aria-expanded', String(isOpen));
                                if (sidebarBackdrop) {
                                    if (isOpen) { sidebarBackdrop.classList.remove('hidden'); }
                                    else { sidebarBackdrop.classList.add('hidden'); }
                                }
                            });
                            if (sidebarBackdrop) {
                                sidebarBackdrop.addEventListener('click', function() {
                                    if (sidebar.classList.contains('open')) {
                                        sidebar.classList.remove('open');
                                        sidebarBackdrop.classList.add('hidden');
                                        menuToggle.setAttribute('aria-expanded', 'false');
                                    }
                                });
                            }
                        }
                        wireMenu();
                        setTimeout(wireMenu, 250);
                        // Toast notifications use the global adapter (init-shared.js)

                        // Beta feature notification helper
                        window.showBetaFeatureNotification = function(featureName) {
                            showToast(`${featureName} is coming soon! This is a beta preview.`);
                        };

                                                // Initialize feature flags on page load and show sign-in CTA if needed
                        document.addEventListener('DOMContentLoaded', async function() {
                                                        const AUTH_DISABLED = window.AUTH_DISABLED === true;
                            const token = (window.getToken && window.getToken()) || null;
                                                        if (!token && !AUTH_DISABLED) {
                                                                showSignInCTA();
                                                                return;
                                                        }
                                                        if (window.FeatureFlags) {
                                                                await window.FeatureFlags.toggleElements('#beta-features-section', 'betaFeatures');
                                                                await window.FeatureFlags.toggleElements('#new-dashboard-section', 'newDashboard');
                                                        }
                                                });

                                                function showSignInCTA(){
                                                    try {
                                                        const main = document.getElementById('main-content');
                                                        if (!main) return;
                                                        // Hide content sections
                                                        Array.from(main.children).forEach(c => c.classList.add('hidden'));
                                                        let cta = document.getElementById('signin-cta');
                                                        if (!cta) {
                                                            cta = document.createElement('div');
                                                            cta.id = 'signin-cta';
                                                            cta.className = 'mt-6 p-6 border border-gray-700 rounded-lg text-center';
                                                            const msg = document.createElement('p');
                                                            msg.className = 'mb-4 text-gray-300';
                                                            msg.textContent = 'Please sign in to access the Administration dashboard.';
                                                            const btn = document.createElement('button');
                                                            btn.className = 'btn-neon-blue px-4 py-2 rounded';
                                                            btn.textContent = 'Sign in';
                                                            btn.addEventListener('click', function(){
                                                                const returnUrl = encodeURIComponent(window.location.pathname + window.location.search);
                                                                window.location.href = `login.html?message=login-required&returnUrl=${returnUrl}`;
                                                            });
                                                            cta.appendChild(msg);
                                                            cta.appendChild(btn);
                                                            main.appendChild(cta);
                                                        }
                                                        cta.classList.remove('hidden');
                                                    } catch(_) { /* noop */ }
                                                }
                    </script>
</body>
</html>