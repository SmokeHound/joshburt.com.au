<!-- Shared Page Header Component
  Usage: Include this in pages and call window.PageHeader.render() with options
  
  Example:
    <div id="page-header-container"></div>
    <script>
      window.PageHeader.render({
        title: 'Page Title',
        subtitle: 'Optional description',
        icon: 'settings', // Optional: home, user, settings, products, orders, analytics, etc.
        actions: [ // Optional array of action buttons
          { label: 'Add New', className: 'ui-btn ui-btn-primary', onClick: 'handleAdd' },
          { label: 'Refresh', className: 'ui-btn ui-btn-secondary', onClick: 'handleRefresh' }
        ],
        gradient: true, // Optional: adds animated gradient background
        containerId: 'page-header-container' // Optional: defaults to 'page-header-container'
      });
    </script>
-->

<script>
(function() {
  'use strict';

  // Icon library - SVG paths for common icons
  const ICONS = {
    home: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 10.5L12 3l9 7.5V21a1.5 1.5 0 01-1.5 1.5H4.5A1.5 1.5 0 013 21V10.5z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 22v-6h6v6"></path>',
    user: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>',
    users: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />',
    settings: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />',
    products: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />',
    orders: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />',
    analytics: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />',
    logs: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />',
    filter: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>',
    consumables: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.5 7.5h10.5"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.5 12.5h10.5"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.5 17.5h10.5"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 7.5l1.75 1.75L8 7"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 12.5l1.75 1.75L8 12"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 17.5l1.75 1.75L8 17"></path>',
    notification: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />',
    search: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>',
    refresh: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />',
    admin: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 2.5l7 2.8v6.2c0 5-3.5 9.5-7 9.5s-7-4.5-7-9.5V5.3l7-2.8z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12.5l2.2 2.2 4-4"></path>'
  };

  // PageHeader API
  window.PageHeader = {
    /**
     * Render a page header with consistent styling
     * @param {Object} options - Configuration options
     * @param {string} options.title - Main heading text (required)
     * @param {string} [options.subtitle] - Optional subtitle/description
     * @param {string} [options.icon] - Optional icon key from ICONS library
     * @param {Array} [options.actions] - Optional array of action buttons
     * @param {boolean} [options.gradient] - Optional animated gradient background
     * @param {string} [options.containerId] - Optional container ID (default: 'page-header-container')
     * @param {string} [options.className] - Optional additional CSS classes
     * @param {Object} [options.metadata] - Optional metadata to display (e.g., last updated)
     */
    render: function(options) {
      if (!options || !options.title) {
        console.error('PageHeader.render: title is required');
        return;
      }

      const containerId = options.containerId || 'page-header-container';
      const container = document.getElementById(containerId);
      
      if (!container) {
        console.error(`PageHeader.render: container #${containerId} not found`);
        return;
      }

      // Build icon HTML if provided
      let iconHtml = '';
      if (options.icon && ICONS[options.icon]) {
        iconHtml = `
          <div class="w-12 h-12 md:w-16 md:h-16 rounded-2xl bg-[color:var(--token-bg-elevated)] border border-[color:var(--token-border-default)] flex items-center justify-center flex-shrink-0 shadow-xl">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 md:h-9 md:w-9 text-[color:var(--token-color-primary)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              ${ICONS[options.icon]}
            </svg>
          </div>
        `;
      }

      // Build subtitle HTML if provided
      let subtitleHtml = '';
      if (options.subtitle) {
        subtitleHtml = `<p class="text-sm md:text-base text-[color:var(--token-text-secondary)] mt-2">${this._escapeHtml(options.subtitle)}</p>`;
      }

      // Build actions HTML if provided
      let actionsHtml = '';
      if (options.actions && Array.isArray(options.actions) && options.actions.length > 0) {
        const actionButtons = options.actions.map((action, index) => {
          const id = action.id || `page-header-action-${index}`;
          const label = this._escapeHtml(action.label || 'Action');
          const className = action.className || 'ui-btn ui-btn-primary';
          const ariaLabel = action.ariaLabel ? `aria-label="${this._escapeHtml(action.ariaLabel)}"` : '';
          const title = action.title ? `title="${this._escapeHtml(action.title)}"` : '';
          
          return `<button id="${id}" class="${className} px-4 py-2 rounded" ${ariaLabel} ${title}>${label}</button>`;
        }).join('');

        actionsHtml = `
          <div class="flex items-center gap-2 md:gap-3 flex-wrap">
            ${actionButtons}
          </div>
        `;
      }

      // Build metadata HTML if provided
      let metadataHtml = '';
      if (options.metadata) {
        const metaItems = Object.entries(options.metadata).map(([key, value]) => {
          return `<div class="text-xs text-[color:var(--token-text-muted)]">${this._escapeHtml(key)}: <span class="text-[color:var(--token-text-secondary)]">${this._escapeHtml(value)}</span></div>`;
        }).join('');
        metadataHtml = `<div class="text-right">${metaItems}</div>`;
      }

      // Build gradient background if requested
      let gradientHtml = '';
      if (options.gradient) {
        gradientHtml = `
          <div class="absolute inset-0 bg-gradient-to-br from-blue-500/5 via-purple-500/5 to-cyan-500/5 opacity-50" aria-hidden="true"></div>
        `;
      }

      // Determine if we need relative positioning for gradient
      const positionClass = options.gradient ? 'relative overflow-hidden' : '';
      const contentClass = options.gradient ? 'relative z-10' : '';

      // Additional custom classes
      const customClass = options.className || '';

      // Build final header HTML
      const headerHtml = `
        <header class="page-header ui-card border ${positionClass} ${customClass}" role="banner">
          ${gradientHtml}
          <div class="${contentClass} flex flex-col md:flex-row md:items-center justify-between gap-4">
            <div class="flex items-center gap-3 md:gap-4 flex-1">
              ${iconHtml}
              <div class="flex-1 min-w-0">
                <h1 class="text-2xl md:text-3xl font-bold text-[color:var(--token-text-primary)] truncate">${this._escapeHtml(options.title)}</h1>
                ${subtitleHtml}
              </div>
            </div>
            <div class="flex items-center gap-4 flex-wrap md:flex-nowrap">
              ${metadataHtml}
              ${actionsHtml}
            </div>
          </div>
        </header>
      `;

      // Insert into container
      container.innerHTML = headerHtml;

      // Attach event handlers if provided
      if (options.actions && Array.isArray(options.actions)) {
        options.actions.forEach((action, index) => {
          const id = action.id || `page-header-action-${index}`;
          const btn = document.getElementById(id);
          
          if (btn && action.onClick) {
            if (typeof action.onClick === 'function') {
              btn.addEventListener('click', action.onClick);
            } else if (typeof action.onClick === 'string' && typeof window[action.onClick] === 'function') {
              btn.addEventListener('click', window[action.onClick]);
            }
          }
        });
      }
    },

    /**
     * Simple HTML escape for security
     */
    _escapeHtml: function(text) {
      const div = document.createElement('div');
      div.textContent = String(text || '');
      return div.innerHTML;
    }
  };

  // Auto-execute if data attributes are present on page load
  document.addEventListener('DOMContentLoaded', function() {
    const container = document.querySelector('[data-page-header]');
    if (container) {
      const options = {
        title: container.getAttribute('data-title') || 'Page Title',
        subtitle: container.getAttribute('data-subtitle'),
        icon: container.getAttribute('data-icon'),
        gradient: container.hasAttribute('data-gradient'),
        containerId: container.id || 'page-header-container'
      };
      
      window.PageHeader.render(options);
    }
  });
})();
</script>
