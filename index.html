<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Home</title>
  <link rel="manifest" href="./manifest.json" />
  <link rel="apple-touch-icon" href="./assets/images/logo-placeholder.svg" />
  <link rel="stylesheet" href="./assets/css/styles.css" />
  <script src="./assets/js/init-shared.js" defer></script>
  <script src="./assets/js/notifications.js" defer></script>
</head>
<body class="dark">
  <!-- MOBILE MENU TOGGLE -->
  <button id="menu-toggle" class="md:hidden fixed top-4 left-4 z-50 p-2 bg-primary text-white rounded-md focus:outline-none focus:ring-2 focus:ring-secondary" aria-label="Toggle sidebar" aria-expanded="false">â˜°</button>
  <div id="sidebar-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>
  <div class="flex min-h-screen">
    <!-- Shared Navigation Loader -->
    <div id="main-nav"></div>
    <script>
      // Dynamically load shared navigation
      fetch('shared-nav.html')
        .then(response => response.text())
        .then(html => { document.getElementById('main-nav').innerHTML = html; });
    </script>

    <!-- Main Content -->
    <main class="flex-1 p-4 md:p-6 ml-64 md:ml-0">
      <!-- Header with Welcome + Actions -->
      <header class="sticky top-0 p-6 rounded-lg shadow-md mb-6 z-40 border card">
        <div class="flex items-center justify-between gap-4">
          <div>
            <h2 id="welcome-message" class="text-3xl font-bold text-white">Welcome!</h2>
            <p class="text-lg mt-2 nav-link-muted">Your dashboard overview</p>
          </div>
          <div class="flex items-start gap-4">
            <div id="role-switcher" class="hidden"></div>
            <div id="notification-bell-wrapper" class="relative"></div>
          </div>
        </div>
      </header>

      <!-- Quick Links -->
      <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" aria-label="Quick links">
        <a href="administration.html" class="card widget-primary p-6 rounded-lg shadow-md block focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
          <h3 class="text-xl font-semibold mb-2 text-white">Administration</h3>
          <p class="nav-link-muted">Manage users, settings, and more.</p>
        </a>
        <a href="analytics.html" class="card widget-secondary p-6 rounded-lg shadow-md block focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
          <h3 class="text-xl font-semibold mb-2 text-white">Analytics</h3>
          <p class="nav-link-muted">View traffic and usage charts.</p>
        </a>
        <a href="oil.html" class="card widget-accent p-6 rounded-lg shadow-md block focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
          <h3 class="text-xl font-semibold mb-2 text-white">Oil Orders</h3>
          <p class="nav-link-muted">Place or review oil product orders.</p>
        </a>
      </section>
    </main>
  </div>

  <!-- Role-based Dashboard System (kept minimal and safe) -->
  <script>
    (function(){
      var userRoles = {
        admin: { name: 'Administrator', dashboards: ['admin','analytics'] },
        manager: { name: 'Manager', dashboards: ['manager'] },
        user: { name: 'User', dashboards: ['user'] }
      };
      var currentUser;
      try { currentUser = JSON.parse(localStorage.getItem('currentUser') || '{"role":"admin","name":"Josh"}'); } catch(e){ currentUser = { role:'admin', name:'Josh' }; }
      function updateDashboard(){
        var welcomeMessage = document.getElementById('welcome-message');
        if (welcomeMessage){
          var roleObj = userRoles[currentUser.role];
          var roleName = roleObj ? roleObj.name : 'User';
          welcomeMessage.textContent = 'Welcome, ' + roleName + '!';
        }
      }
      window.setUserRole = function(role){
        if (userRoles[role]){
          currentUser.role = role;
          localStorage.setItem('currentUser', JSON.stringify(currentUser));
          updateDashboard();
          if (window.showNotification){ window.showNotification('Switched to ' + userRoles[role].name + ' role','success'); }
        }
      };
      document.addEventListener('DOMContentLoaded', function(){
        var roleSwitcher = document.getElementById('role-switcher');
        if (roleSwitcher){
          roleSwitcher.classList.remove('hidden');
          var options = Object.keys(userRoles).map(function(key){
            var selected = key === currentUser.role ? 'selected' : '';
            return '<option value="'+key+'" '+selected+'>'+userRoles[key].name+'</option>';
          }).join('');
          roleSwitcher.innerHTML = '<div><label class="block text-sm font-medium text-gray-300 mb-1">Role (Demo)</label><select id="role-selector" class="w-full px-2 py-1 text-sm bg-gray-700 border border-gray-600 rounded text-white focus:outline-none focus:ring-2 focus:ring-secondary">'+options+'</select></div>';
          var sel = document.getElementById('role-selector');
          if (sel){ sel.addEventListener('change', function(e){ window.setUserRole(e.target.value); }); }
        }
        updateDashboard();
      });
    })();
  </script>

  <!-- Minimal mobile menu wiring after nav injection -->
  <script>
    document.addEventListener('DOMContentLoaded', function(){
      function wireMenu(){
        var menuToggle=document.getElementById('menu-toggle');
        var sidebar=document.getElementById('sidebar');
        var sidebarBackdrop=document.getElementById('sidebar-backdrop');
        if(!(menuToggle && sidebar)) return;
        function toggle(){
          var isOpen = sidebar.classList.toggle('open');
          menuToggle.setAttribute('aria-expanded', String(isOpen));
          if(sidebarBackdrop){
            if(isOpen){ sidebarBackdrop.classList.remove('hidden'); }
            else { sidebarBackdrop.classList.add('hidden'); }
          }
          document.body.classList.toggle('sidebar-open', isOpen);
        }
        menuToggle.addEventListener('click', toggle);
        if(sidebarBackdrop){ sidebarBackdrop.addEventListener('click', function(){ if(sidebar.classList.contains('open')) toggle(); }); }
      }
      wireMenu();
      setTimeout(wireMenu, 250);
    });
  </script>
</body>
</html>