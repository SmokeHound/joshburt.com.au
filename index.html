<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Josh's App - Home</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#10b981',
                        accent: '#8b5cf6',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
                    },
                },
            },
        };
    </script>
    <style>
        body {
            transition: background-color 0.3s, color 0.3s;
        }
        .dark {
            background-color: #1f2937;
            color: #f9fafb;
        }
        .light {
            background-color: #f9fafb;
            color: #1f2937;
        }
        .sidebar {
            transition: transform 0.3s ease-in-out;
        }
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.open {
                transform: translateX(0);
            }
        }
        .card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="dark min-h-screen flex flex-col md:flex-row font-sans">
    <!-- Load shared navigation component -->
    <div id="shared-navigation"></div>
    <script>
        fetch('shared-nav.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('shared-navigation').innerHTML = html;
                // Initialize page-specific functionality after navigation loads
                initializeHomePage();
            })
            .catch(() => {
                // Fallback if fetch fails - initialize anyway
                setTimeout(initializeHomePage, 100);
            });
    </script>

    <!-- Login Modal -->
    <div id="login-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" role="dialog" aria-modal="true" aria-labelledby="login-modal-title">
        <div class="bg-gray-800 p-6 rounded-lg w-full max-w-md">
            <h2 id="login-modal-title" class="text-xl font-semibold mb-4 text-white">Login</h2>
            <form id="login-form">
                <div class="mb-4">
                    <label for="email" class="block text-sm text-white">Email</label>
                    <input type="email" id="email" class="w-full p-2 rounded bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-primary" required aria-required="true">
                </div>
                <div class="mb-4">
                    <label for="password" class="block text-sm text-white">Password</label>
                    <input type="password" id="password" class="w-full p-2 rounded bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-primary" required aria-required="true">
                </div>
                <div id="login-error" class="hidden text-red-500 text-sm mb-4"></div>
                <button type="submit" id="submit-login" class="w-full p-2 bg-primary text-white rounded hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-secondary" aria-label="Submit login">
                    Login <span id="login-spinner" class="hidden inline-block w-4 h-4 border-2 border-t-transparent border-white rounded-full animate-spin"></span>
                </button>
            </form>
            <button id="close-modal" class="mt-4 w-full p-2 bg-gray-600 text-white rounded hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-400" aria-label="Close login modal">Close</button>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="hidden fixed bottom-4 right-4 p-4 bg-accent text-white rounded shadow-lg transition-opacity duration-300" role="alert" aria-live="polite"></div>

    <!-- Main Content -->
    <main class="flex-1 p-4">
        <!-- Sticky Header -->
        <header class="sticky top-0 bg-gray-700 dark:bg-gray-700 p-4 rounded shadow mb-6 z-40">
            <h2 class="text-3xl font-semibold" id="welcome-message">Welcome to My Website</h2>
        </header>

        <!-- Content Section -->
        <section>
            <p class="mb-4">This is a responsive website template with a sidebar, dark/light mode support, and enhanced user authentication.</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="p-4 bg-gray-700 dark:bg-gray-700 rounded shadow card">
                    <h3 class="font-semibold">Card 1</h3>
                    <p>Sample content for a card.</p>
                </div>
                <div class="p-4 bg-gray-700 dark:bg-gray-700 rounded shadow card">
                    <h3 class="font-semibold">Card 2</h3>
                    <p>Sample content for a card.</p>
                </div>
                <div class="p-4 bg-gray-700 dark:bg-gray-700 rounded shadow card">
                    <h3 class="font-semibold">Card 3</h3>
                    <p>Sample content for a card.</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Load shared theme functionality -->
    <script>
        fetch('shared-theme.html')
            .then(response => response.text())
            .then(html => {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;
                const scripts = tempDiv.getElementsByTagName('script');
                for (let script of scripts) {
                    const newScript = document.createElement('script');
                    newScript.textContent = script.textContent;
                    document.body.appendChild(newScript);
                }
            });
    </script>

    <!-- Home-specific functionality -->
    <script>
        function initializeHomePage() {
            // Load and apply site settings
            function loadAndApplySettings() {
                const settings = JSON.parse(localStorage.getItem('siteSettings')) || {};
                
                // Apply site title if set
                if (settings['site-title']) {
                    const brandingElements = document.querySelectorAll('h1');
                    brandingElements.forEach(el => {
                        if (el.textContent.includes('Josh\'s App')) {
                            el.textContent = settings['site-title'];
                        }
                    });
                }
                
                // Apply homepage message if set
                if (settings['homepage-message']) {
                    const welcomeMessage = document.getElementById('welcome-message');
                    const currentUser = JSON.parse(localStorage.getItem('user'));
                    if (welcomeMessage && !currentUser) {
                        welcomeMessage.textContent = settings['homepage-message'];
                    }
                }
            }

            // User Management
            const loginBtn = document.getElementById('login-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const userInfo = document.getElementById('user-info');
            const userName = document.getElementById('user-name');
            const userAvatar = document.getElementById('user-avatar');
            const loginModal = document.getElementById('login-modal');
            const loginForm = document.getElementById('login-form');
            const closeModal = document.getElementById('close-modal');
            const loginSpinner = document.getElementById('login-spinner');
            const loginError = document.getElementById('login-error');
            const toast = document.getElementById('toast');
            const welcomeMessage = document.getElementById('welcome-message');

            // Show toast notification
            function showToast(message) {
                if (toast) {
                    toast.textContent = message;
                    toast.classList.remove('hidden');
                    setTimeout(() => {
                        toast.classList.add('hidden');
                    }, 3000);
                }
            }

            // Check if user is logged in
            const user = JSON.parse(localStorage.getItem('user'));
            if (user) {
                userInfo?.classList.remove('hidden');
                loginBtn?.classList.add('hidden');
                logoutBtn?.classList.remove('hidden');
                if (userName) userName.textContent = user.name;
                if (userAvatar) userAvatar.src = user.avatar || 'https://via.placeholder.com/40';
                if (welcomeMessage) welcomeMessage.textContent = `Welcome, ${user.name}!`;
            } else {
                loadAndApplySettings();
            }

            // Open login modal
            loginBtn?.addEventListener('click', () => {
                loginModal?.classList.remove('hidden');
            });

            // Close login modal
            closeModal?.addEventListener('click', () => {
                loginModal?.classList.add('hidden');
                loginForm?.reset();
                loginError?.classList.add('hidden');
            });

            // Handle login
            loginForm?.addEventListener('submit', async (e) => {
                e.preventDefault();
                loginSpinner?.classList.remove('hidden');
                loginError?.classList.add('hidden');

                const email = document.getElementById('email')?.value;
                const password = document.getElementById('password')?.value;

                try {
                    const users = JSON.parse(localStorage.getItem('siteUsers') || '[]');
                    const registeredUser = users.find(u => u.email === email);
                    
                    let authenticatedUser = null;
                    
                    if (registeredUser && password === 'password') {
                        authenticatedUser = { 
                            name: registeredUser.name, 
                            email: registeredUser.email,
                            avatar: 'https://via.placeholder.com/40' 
                        };
                    } else if (email === 'test@example.com' && password === 'password') {
                        authenticatedUser = { 
                            name: email.split('@')[0], 
                            email: email,
                            avatar: 'https://via.placeholder.com/40' 
                        };
                    } else {
                        throw new Error('Invalid credentials');
                    }

                    localStorage.setItem('user', JSON.stringify(authenticatedUser));
                    userInfo?.classList.remove('hidden');
                    loginBtn?.classList.add('hidden');
                    logoutBtn?.classList.remove('hidden');
                    if (userName) userName.textContent = authenticatedUser.name;
                    if (userAvatar) userAvatar.src = authenticatedUser.avatar;
                    if (welcomeMessage) welcomeMessage.textContent = `Welcome, ${authenticatedUser.name}!`;
                    loginModal?.classList.add('hidden');
                    loginForm?.reset();
                    showToast('Login successful!');
                } catch (error) {
                    if (loginError) {
                        loginError.textContent = error.message;
                        loginError.classList.remove('hidden');
                    }
                } finally {
                    loginSpinner?.classList.add('hidden');
                }
            });

            // Handle logout
            logoutBtn?.addEventListener('click', async () => {
                localStorage.removeItem('user');
                userInfo?.classList.add('hidden');
                loginBtn?.classList.remove('hidden');
                logoutBtn?.classList.add('hidden');
                
                const settings = JSON.parse(localStorage.getItem('siteSettings')) || {};
                if (welcomeMessage) welcomeMessage.textContent = settings['homepage-message'] || 'Welcome to My Website';
                showToast('Logged out successfully!');
            });

            loadAndApplySettings();
        }

        // Fallback initialization if navigation doesn't load via fetch
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                if (!document.getElementById('menu-toggle')) {
                    // Navigation didn't load, initialize without it
                    initializeHomePage();
                }
            }, 1000);
        });
    </script>
</body>
</html>