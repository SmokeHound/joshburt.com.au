<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="./manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="JoshBurt.com.au">
    <link rel="apple-touch-icon" href="./assets/images/logo-placeholder.svg">
    
    <!-- Include shared configuration -->
    <script>
        fetch('shared-config.html')
            .then(response => response.text())
            .then(html => {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;
                // Inject styles and scripts into head
                const styles = tempDiv.getElementsByTagName('style');
                const scripts = tempDiv.getElementsByTagName('script');
                const links = tempDiv.getElementsByTagName('link');
                
                for (let link of links) {
                    document.head.appendChild(link.cloneNode(true));
                }
                for (let style of styles) {
                    document.head.appendChild(style.cloneNode(true));
                }
                for (let script of scripts) {
                    const newScript = document.createElement('script');
                    newScript.textContent = script.textContent;
                    document.head.appendChild(newScript);
                }
            });
    </script>
    <script>
        // Configuration for dynamic color updates from settings
        function applyDynamicColors() {
            const settingsHead = JSON.parse(localStorage.getItem('siteSettings')) || {};
            // Apply CSS variables for instant color update
            document.documentElement.style.setProperty('--tw-color-primary', settingsHead.primaryColor || '#3b82f6');
            document.documentElement.style.setProperty('--tw-color-secondary', settingsHead.secondaryColor || '#10b981');
            document.documentElement.style.setProperty('--tw-color-accent', settingsHead.accentColor || '#8b5cf6');
        }
        applyDynamicColors();
        // Service Worker Registration for PWA
        if ("serviceWorker" in navigator) {
            window.addEventListener("load", () => {
                navigator.serviceWorker.register("./sw.js")
                    .then(registration => {
                        console.log("SW registered: ", registration);
                    })
                    .catch(registrationError => {
                        console.log("SW registration failed: ", registrationError);
                    });
            });
        }
    </script>
    <style>
        body {
            transition: background-color 0.3s, color 0.3s;
            background-color: #0a0a0a;
            color: #ffffff;
    /* End of .sr-only and focus:not-sr-only styles */
        .dark {
            background-color: #0a0a0a;
            color: #ffffff;
        }
        .light {
            background-color: #f9fafb;
            color: #1f2937;
        }
        .sidebar {
            transition: transform 0.3s ease-in-out;
            background-color: #111111;
            border-right: 1px solid #00d4ff20;
        }

        /* Screen reader only class */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        .card {
            transition: transform 0.2s, box-shadow 0.2s;
            background-color: #111111;
            border: 1px solid #333333;
        }
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 20px rgba(0, 212, 255, 0.3);
            border-color: #00d4ff;
        }
        
        /* Widget specific neon colors */
        .widget-primary {
            border-color: #00d4ff40;
        }
        .widget-primary:hover {
            box-shadow: 0 4px 20px rgba(0, 212, 255, 0.4);
            border-color: #00d4ff;
        }
        .widget-secondary {
            border-color: #00ff8840;
        }
        .widget-secondary:hover {
            box-shadow: 0 4px 20px rgba(0, 255, 136, 0.4);
            border-color: #00ff88;
        }
        .widget-accent {
            border-color: #8000ff40;
        }
        .widget-accent:hover {
            box-shadow: 0 4px 20px rgba(128, 0, 255, 0.4);
            border-color: #8000ff;
        }
        
        /* Mobile sidebar styles */
        @media (max-width: 767px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease-in-out;
                z-index: 40;
                background-color: #111111;
            }
            .sidebar.open {
                transform: translateX(0);
            }
            .sidebar-backdrop {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(0, 0, 0, 0.8);
                z-index: 30;
                opacity: 0;
                pointer-events: none;
                transition: opacity 0.3s ease-in-out;
            }
            .sidebar-backdrop.show {
                opacity: 1;
                pointer-events: auto;
            }
            body.sidebar-open {
                overflow: hidden;
            }
        }
        @media (min-width: 768px) and (max-width: 1023px) {
            .sidebar {
                width: 200px;
            }
            main {
                margin-left: 200px;
            }
        }
        }
        /* Tablet and desktop optimizations */
        @media (min-width: 768px) {
            .sidebar {
                width: 16rem;
            }
            main {
                margin-left: 16rem;
            }
        }
    </style>
</head>
<body class="dark min-h-screen flex flex-col md:flex-row font-sans">
    <!-- Skip Links for Accessibility -->
    <div class="sr-only">
        <a href="#main-content" class="absolute top-0 left-0 bg-primary text-white p-2 rounded focus:not-sr-only focus:z-50">Skip to main content</a>
        <a href="#sidebar" class="absolute top-0 left-0 bg-primary text-white p-2 rounded focus:not-sr-only focus:z-50">Skip to navigation</a>
    </div>

    <!-- Mobile Menu Toggle -->
    <button id="menu-toggle" class="md:hidden fixed top-4 left-4 z-50 p-2 bg-primary text-white rounded-md focus:outline-none focus:ring-2 focus:ring-secondary" aria-label="Toggle sidebar" aria-expanded="false">
        â˜°
    </button>

    <!-- Mobile sidebar backdrop -->
    <div id="sidebar-backdrop" class="sidebar-backdrop md:hidden"></div>

    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar w-64 fixed top-0 left-0 h-full p-4 flex flex-col shadow-lg md:static md:translate-x-0" style="background-color: #111111; border-right: 1px solid #00d4ff20;" aria-label="Main navigation" role="navigation">
        <!-- App Branding -->
        <h1 class="text-2xl font-bold mb-6" style="color: #00d4ff; text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);">Josh's App</h1>

        <!-- User Profile Section -->
        <div id="user-profile" class="mb-6">
            <div id="user-info" class="hidden flex items-center space-x-2">
                <img id="user-avatar" src="https://via.placeholder.com/40" alt="User avatar" class="w-10 h-10 rounded-full" loading="lazy">
                <span id="user-name" class="text-white"></span>
            </div>
            <button id="login-btn" class="w-full p-2 text-black rounded focus:outline-none focus:ring-2 focus:ring-secondary btn-neon-blue" aria-label="Open login modal">Login</button>
            <button id="logout-btn" class="hidden w-full p-2 text-white rounded focus:outline-none focus:ring-2 focus:ring-red-400 btn-neon-pink" aria-label="Logout">Logout</button>
        </div>

        <!-- Navigation -->
        <nav role="navigation" aria-label="Main navigation">
            <ul class="space-y-2" role="list">
                <li role="listitem">
                    <a href="index.html" class="block p-2 rounded focus:outline-none focus:ring-2 focus:ring-secondary nav-link active" style="color: #00d4ff; background-color: #00d4ff20; border-left: 3px solid #00d4ff;" aria-current="page">Home</a>
                </li>
                <li role="listitem">
                    <a href="administration.html" class="block p-2 rounded focus:outline-none focus:ring-2 focus:ring-secondary nav-link" style="color: #cccccc;">Administration</a>
                </li>
                <li role="listitem">
                    <a href="users.html" class="block p-2 rounded focus:outline-none focus:ring-2 focus:ring-secondary nav-link" style="color: #cccccc;">User Management</a>
                </li>
                <li role="listitem">
                    <a href="analytics.html" class="block p-2 rounded focus:outline-none focus:ring-2 focus:ring-secondary nav-link" style="color: #cccccc;">Analytics</a>
                </li>
                <li role="listitem">
                    <a href="settings.html" class="block p-2 rounded focus:outline-none focus:ring-2 focus:ring-secondary nav-link" style="color: #cccccc;">Settings</a>
                </li>
                <li role="listitem">
                    <a href="oil.html" class="block p-2 rounded focus:outline-none focus:ring-2 focus:ring-secondary nav-link" style="color: #cccccc;">Oil Orders</a>
                </li>
                <li role="listitem">
                    <a href="consumables.html" class="block p-2 rounded focus:outline-none focus:ring-2 focus:ring-secondary nav-link" style="color: #cccccc;">Consumables Orders</a>
                </li>
                <li role="listitem">
                    <a href="login.html" class="block p-2 rounded focus:outline-none focus:ring-2 focus:ring-red-400 nav-link" style="color: #ff0080;">Logout</a>
                </li>
            </ul>
        </nav>

        <!-- Theme Toggle -->
        <div class="mt-auto">
            <button id="theme-toggle" class="w-full p-2 text-black rounded focus:outline-none focus:ring-2 focus:ring-secondary btn-neon-green" aria-label="Toggle light mode" aria-pressed="false">
                Toggle Light Mode
            </button>
        </div>
    </aside>

    <!-- Login Modal -->
    <div id="login-modal" class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center" role="dialog" aria-modal="true" aria-labelledby="login-modal-title">
        <div class="p-6 rounded-lg w-full max-w-md shadow-xl border" style="background-color: #111111; border-color: #333333;">
            <h2 id="login-modal-title" class="text-xl font-semibold mb-4 text-white">Login</h2>
            <p id="login-modal-description" class="sr-only">Please enter your email and password to login</p>
            <form id="login-form" role="form" aria-labelledby="login-modal-title">
                <div class="mb-4">
                    <label for="email" class="block text-sm mb-1" style="color: #cccccc;">Email</label>
                    <input type="email" id="email" class="w-full p-3 rounded-lg border focus:outline-none focus:ring-2 focus:border-transparent" style="background-color: #181818; border-color: #333333; color: #ffffff;" required aria-required="true">
                </div>
                <div class="mb-4">
                    <label for="password" class="block text-sm mb-1" style="color: #cccccc;">Password</label>
                    <input type="password" id="password" class="w-full p-3 rounded-lg border focus:outline-none focus:ring-2 focus:border-transparent" style="background-color: #181818; border-color: #333333; color: #ffffff;" required aria-required="true">
                </div>
                <div id="login-error" class="hidden text-sm mb-4 p-2 rounded-md" style="color: #ff0080; background-color: #ff008020;"></div>
                <button type="submit" id="submit-login" class="w-full p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors duration-200 btn-neon-blue" aria-label="Submit login">
                    Login <span id="login-spinner" class="hidden inline-block w-4 h-4 border-2 border-t-transparent border-white rounded-full animate-spin ml-2"></span>
                </button>
            </form>
            <button id="close-modal" class="mt-4 w-full p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 text-base transition-colors duration-200" style="background-color: #333333; color: #ffffff;" aria-label="Close login modal">Close</button>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden fixed bottom-4 right-4 p-4 rounded-lg shadow-lg transition-opacity duration-300" style="background-color: #00d4ff; color: #000000;" role="alert" aria-live="polite"></div>

    <!-- Main Content -->
    <main id="main-content" class="flex-1 p-4" role="main" style="background-color: #0a0a0a;">
        <!-- Sticky Header -->
        <header class="sticky top-0 p-6 rounded-lg shadow-md mb-6 z-40 border" style="background-color: #111111; border-color: #333333;">
            <h2 class="text-3xl font-bold text-white" id="welcome-message">Welcome, Admin!</h2>
            <p class="text-lg mt-2" style="color: #cccccc;">Administrative Dashboard & Controls</p>
        </header>

        <!-- Content Section -->
        <section aria-label="Administrative functions" class="space-y-6">
            <p class="mb-6 leading-relaxed" style="color: #cccccc;">This is your dashboard. Here you can manage users, view site analytics, and perform administrative tasks.</p>
            
            <!-- Admin Cards Grid -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" role="region" aria-label="Admin functions">
                <div class="card widget-primary p-6 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2" tabindex="0" role="article">
                    <h3 class="text-xl font-semibold mb-3 text-white">User Management</h3>
                    <p class="mb-4" style="color: #cccccc;">Manage user accounts and permissions.</p>
                    <a href="users.html" class="w-full block p-3 text-black rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 text-center transition-colors duration-200 btn-neon-blue">Manage Users</a>
                </div>
                <div class="card widget-secondary p-6 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2" tabindex="0" role="article">
                    <h3 class="text-xl font-semibold mb-3 text-white">Analytics</h3>
                    <p class="mb-4" style="color: #cccccc;">View site statistics and user engagement.</p>
                    <a href="analytics.html" class="w-full block p-3 text-black rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 text-center transition-colors duration-200 btn-neon-green">View Analytics</a>
                </div>
                <div class="card widget-accent p-6 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2" tabindex="0" role="article">
                    <h3 class="text-xl font-semibold mb-3 text-white">Site Settings</h3>
                    <p class="mb-4" style="color: #cccccc;">Configure website settings and preferences.</p>
                    <a href="settings.html" class="w-full block p-3 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 text-center transition-colors duration-200 btn-neon-purple">Site Settings</a>
                </div>
                <div class="card widget-primary p-6 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2" tabindex="0" role="article">
                    <h3 class="text-xl font-semibold mb-3 text-white">Product Management</h3>
                    <p class="mb-4" style="color: #cccccc;">Manage oil products, add descriptions and images.</p>
                    <a href="oil-products-management.html" class="w-full block p-3 text-black rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 text-center transition-colors duration-200 btn-neon-blue">Manage Products</a>
                </div>
            </div>
        </section>
    </main>

    <!-- Load shared theme functionality -->
    <script>
        fetch('shared-theme.html')
            .then(response => response.text())
            .then(html => {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;
                const scripts = tempDiv.getElementsByTagName('script');
                for (let script of scripts) {
                    const newScript = document.createElement('script');
                    newScript.textContent = script.textContent;
                    document.body.appendChild(newScript);
                }
            });
    </script>

    <!-- Home-specific functionality -->
    <script>
        function initializeHomePage() {
            // Load and apply site settings
            function loadAndApplySettings() {
                const settings = JSON.parse(localStorage.getItem('siteSettings')) || {};
                
                // Apply site title if set
                if (settings['site-title']) {
                    const brandingElements = document.querySelectorAll('h1');
                    brandingElements.forEach(el => {
                        if (el.textContent.includes('Josh\'s App')) {
                            el.textContent = settings['site-title'];
                        }
                    });
                }
                
                // Apply homepage message if set
                if (settings['homepage-message']) {
                    const welcomeMessage = document.getElementById('welcome-message');
                    const currentUser = JSON.parse(localStorage.getItem('user'));
                    if (welcomeMessage && !currentUser) {
                        welcomeMessage.textContent = settings['homepage-message'];
                    }
                }
            }

            // User Management
            const loginBtn = document.getElementById('login-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const userInfo = document.getElementById('user-info');
            const userName = document.getElementById('user-name');
            const userAvatar = document.getElementById('user-avatar');
            const loginModal = document.getElementById('login-modal');
            const loginForm = document.getElementById('login-form');
            const closeModal = document.getElementById('close-modal');
            const loginSpinner = document.getElementById('login-spinner');
            const loginError = document.getElementById('login-error');
            const toast = document.getElementById('toast');
            const welcomeMessage = document.getElementById('welcome-message');

            // Show toast notification
            function showToast(message) {
                if (toast) {
                    toast.textContent = message;
                    toast.classList.remove('hidden');
                    setTimeout(() => {
                        toast.classList.add('hidden');
                    }, 3000);
                }
            }

            // Check if user is logged in
            const user = JSON.parse(localStorage.getItem('user'));
            if (user) {
                userInfo?.classList.remove('hidden');
                loginBtn?.classList.add('hidden');
                logoutBtn?.classList.remove('hidden');
                if (userName) userName.textContent = user.name;
                if (userAvatar) userAvatar.src = user.avatar || 'https://via.placeholder.com/40';
                if (welcomeMessage) welcomeMessage.textContent = `Welcome, Admin!`;
            } else {
                loadAndApplySettings();
            }

            // Open login modal
            loginBtn?.addEventListener('click', () => {
                loginModal?.classList.remove('hidden');
            });

            // Close login modal
            closeModal?.addEventListener('click', () => {
                loginModal?.classList.add('hidden');
                loginForm?.reset();
                loginError?.classList.add('hidden');
            });

            // Handle login
            loginForm?.addEventListener('submit', async (e) => {
                e.preventDefault();
                loginSpinner?.classList.remove('hidden');
                loginError?.classList.add('hidden');

                const email = document.getElementById('email')?.value;
                const password = document.getElementById('password')?.value;

                try {
                    const users = JSON.parse(localStorage.getItem('siteUsers') || '[]');
                    const registeredUser = users.find(u => u.email === email);
                    
                    let authenticatedUser = null;
                    
                    if (registeredUser && password === 'password') {
                        authenticatedUser = { 
                            name: registeredUser.name, 
                            email: registeredUser.email,
                            avatar: 'https://via.placeholder.com/40' 
                        };
                    } else if (email === 'test@example.com' && password === 'password') {
                        authenticatedUser = { 
                            name: email.split('@')[0], 
                            email: email,
                            avatar: 'https://via.placeholder.com/40' 
                        };
                    } else {
                        throw new Error('Invalid credentials');
                    }

                    localStorage.setItem('user', JSON.stringify(authenticatedUser));
                    userInfo?.classList.remove('hidden');
                    loginBtn?.classList.add('hidden');
                    logoutBtn?.classList.remove('hidden');
                    if (userName) userName.textContent = authenticatedUser.name;
                    if (userAvatar) userAvatar.src = authenticatedUser.avatar;
                    if (welcomeMessage) welcomeMessage.textContent = `Welcome, Admin!`;
                    loginModal?.classList.add('hidden');
                    loginForm?.reset();
                    showToast('Login successful!');
                } catch (error) {
                    if (loginError) {
                        loginError.textContent = error.message;
                        loginError.classList.remove('hidden');
                    }
                } finally {
                    loginSpinner?.classList.add('hidden');
                }
            });

            // Handle logout
            logoutBtn?.addEventListener('click', async () => {
                localStorage.removeItem('user');
                userInfo?.classList.add('hidden');
                loginBtn?.classList.remove('hidden');
                logoutBtn?.classList.add('hidden');
                
                const settings = JSON.parse(localStorage.getItem('siteSettings')) || {};
                if (welcomeMessage) welcomeMessage.textContent = settings['homepage-message'] || 'Welcome, Admin!';
                showToast('Logged out successfully!');
            });

            loadAndApplySettings();
        }

        // Initialize home page functionality
        document.addEventListener('DOMContentLoaded', () => {
            initializeHomePage();
        });
    </script>

    <!-- Mobile Menu Toggle Functionality -->
    <script>
        // Mobile menu toggle functionality
        (function() {
            const menuToggle = document.getElementById('menu-toggle');
            const sidebar = document.getElementById('sidebar');
            const sidebarBackdrop = document.getElementById('sidebar-backdrop');
            
            function toggleSidebar() {
                const isOpen = sidebar.classList.contains('open');
                
                if (isOpen) {
                    // Close sidebar
                    sidebar.classList.remove('open');
                    if (sidebarBackdrop) sidebarBackdrop.classList.remove('show');
                    document.body.classList.remove('sidebar-open');
                    menuToggle.setAttribute('aria-expanded', 'false');
                } else {
                    // Open sidebar
                    sidebar.classList.add('open');
                    if (sidebarBackdrop) sidebarBackdrop.classList.add('show');
                    document.body.classList.add('sidebar-open');
                    menuToggle.setAttribute('aria-expanded', 'true');
                }
            }
            
            if (menuToggle && sidebar) {
                menuToggle.addEventListener('click', toggleSidebar);
                
                // Close sidebar when clicking backdrop
                if (sidebarBackdrop) {
                    sidebarBackdrop.addEventListener('click', () => {
                        if (sidebar.classList.contains('open')) {
                            toggleSidebar();
                        }
                    });
                }
                
                // Close sidebar on escape key
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && sidebar.classList.contains('open')) {
                        toggleSidebar();
                    }
                });
            }
        })();
    </script>

    <!-- Future Features Implementation -->
    <script>
        // Multi-language Support System
        (function() {
            const languages = {
                en: { name: 'English', flag: 'ðŸ‡ºðŸ‡¸', translations: {
                    'nav.home': 'Home', 'nav.admin': 'Admin', 'nav.users': 'User Management',
                    'nav.analytics': 'Analytics', 'nav.settings': 'Settings', 'nav.oil': 'Oil Orders',
                    'nav.consumables': 'Consumables Orders', 'nav.logout': 'Logout', 'app.title': "Josh's App", 'language.label': 'Language',
                    'dashboard.welcome': 'Welcome to My Website', 'notifications.title': 'Notifications',
                    'notifications.empty': 'No new notifications'
                }},
                es: { name: 'EspaÃ±ol', flag: 'ðŸ‡ªðŸ‡¸', translations: {
                    'nav.home': 'Inicio', 'nav.admin': 'AdministraciÃ³n', 'nav.users': 'GestiÃ³n de Usuarios',
                    'nav.analytics': 'AnalÃ­ticas', 'nav.settings': 'ConfiguraciÃ³n', 'nav.oil': 'Pedidos de Aceite',
                    'nav.consumables': 'Pedidos de Consumibles', 'nav.logout': 'Cerrar SesiÃ³n', 'app.title': 'AplicaciÃ³n de Josh', 'language.label': 'Idioma',
                    'dashboard.welcome': 'Bienvenido a Mi Sitio Web', 'notifications.title': 'Notificaciones',
                    'notifications.empty': 'No hay notificaciones nuevas'
                }}
            };

            let currentLanguage = localStorage.getItem('siteLanguage') || 'en';
            
            window.t = function(key, fallback = key) {
                return languages[currentLanguage]?.translations[key] || fallback;
            };

            function updateTranslations() {
                document.querySelectorAll('[data-i18n]').forEach(element => {
                    const key = element.getAttribute('data-i18n');
                    element.textContent = window.t(key);
                });
            }

            // Language selector handler
            document.addEventListener('DOMContentLoaded', function() {
                const selector = document.getElementById('language-selector');
                if (selector) {
                    selector.value = currentLanguage;
                    selector.addEventListener('change', function(e) {
                        currentLanguage = e.target.value;
                        localStorage.setItem('siteLanguage', currentLanguage);
                        updateTranslations();
                        if (window.showNotification) {
                            window.showNotification(`Language changed to ${languages[currentLanguage].name}`, 'success');
                        }
                    });
                }
                updateTranslations();
            });
        })();

        // Notifications System
        (function() {
            let notifications = JSON.parse(localStorage.getItem('siteNotifications') || '[]');
            let notificationId = parseInt(localStorage.getItem('notificationId') || '1');

            window.showNotification = function(message, type = 'info', duration = 5000) {
                const notification = {
                    id: notificationId++,
                    message, type,
                    timestamp: Date.now()
                };

                notifications.unshift(notification);
                notifications = notifications.slice(0, 20); // Keep only 20
                localStorage.setItem('siteNotifications', JSON.stringify(notifications));
                localStorage.setItem('notificationId', notificationId.toString());

                // Show toast
                const toast = document.createElement('div');
                const colors = {
                    info: 'bg-blue-600', success: 'bg-green-600', 
                    warning: 'bg-yellow-600', error: 'bg-red-600'
                };
                
                toast.className = `fixed bottom-4 right-4 p-4 ${colors[type] || colors.info} text-white rounded-lg shadow-lg flex items-center gap-3 transform translate-x-full transition-transform duration-300 z-50`;
                toast.innerHTML = `
                    <span>${message}</span>
                    <button onclick="this.parentElement.remove()" class="text-white hover:text-gray-200 font-bold">&times;</button>
                `;

                document.body.appendChild(toast);
                setTimeout(() => toast.classList.remove('translate-x-full'), 100);
                setTimeout(() => {
                    toast.classList.add('translate-x-full');
                    setTimeout(() => toast.remove(), 300);
                }, duration);

                updateNotificationBell();
                return notification.id;
            };

            function updateNotificationBell() {
                let bell = document.getElementById('notification-bell');
                if (!bell) {
                    // Create notification bell in sidebar
                    const nav = document.querySelector('#sidebar nav ul');
                    if (nav) {
                        const li = document.createElement('li');
                        li.className = 'relative';
                        li.innerHTML = `
                            <button id="notification-bell" class="w-full flex items-center justify-between p-2 hover:bg-primary hover:text-white rounded focus:outline-none focus:ring-2 focus:ring-secondary">
                                <span data-i18n="notifications.title">Notifications</span>
                                <span class="flex items-center gap-1">
                                    ðŸ””
                                    <span id="notification-badge" class="bg-red-500 text-white text-xs rounded-full px-1 hidden">0</span>
                                </span>
                            </button>
                            <div id="notification-dropdown" class="hidden absolute left-full top-0 ml-2 w-80 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50">
                                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                                    <h3 class="font-semibold" data-i18n="notifications.title">Notifications</h3>
                                </div>
                                <div id="notification-list" class="max-h-64 overflow-y-auto p-2">
                                    <div class="text-center text-gray-500 p-4" data-i18n="notifications.empty">No new notifications</div>
                                </div>
                            </div>
                        `;
                        nav.appendChild(li);
                        
                        bell = document.getElementById('notification-bell');
                        const dropdown = document.getElementById('notification-dropdown');
                        
                        bell.addEventListener('click', (e) => {
                            e.stopPropagation();
                            dropdown.classList.toggle('hidden');
                        });
                        
                        document.addEventListener('click', () => {
                            dropdown.classList.add('hidden');
                        });
                    }
                }

                const badge = document.getElementById('notification-badge');
                if (badge && notifications.length > 0) {
                    badge.textContent = notifications.length > 99 ? '99+' : notifications.length;
                    badge.classList.remove('hidden');
                } else if (badge) {
                    badge.classList.add('hidden');
                }
            }

            // Initialize notifications
            document.addEventListener('DOMContentLoaded', function() {
                updateNotificationBell();
                
                // Demo: Add some sample notifications
                setTimeout(() => {
                    window.showNotification('Welcome! Future features are now active.', 'success');
                }, 2000);
                
                // Simulate periodic notifications (every 60 seconds)
                setInterval(() => {
                    if (Math.random() < 0.3) {
                        const messages = [
                            'New system update available',
                            'User login detected',
                            'Backup completed successfully',
                            'New order received'
                        ];
                        const types = ['info', 'success', 'warning'];
                        const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                        const randomType = types[Math.floor(Math.random() * types.length)];
                        window.showNotification(randomMessage, randomType);
                    }
                }, 60000);
            });
        })();

        // Role-based Dashboard System
        (function() {
            const userRoles = {
                admin: { name: 'Administrator', dashboards: ['admin', 'analytics'] },
                manager: { name: 'Manager', dashboards: ['manager'] },
                user: { name: 'User', dashboards: ['user'] }
            };

            let currentUser = JSON.parse(localStorage.getItem('currentUser') || '{"role": "admin", "name": "Josh"}');

            window.setUserRole = function(role) {
                if (userRoles[role]) {
                    currentUser.role = role;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    updateDashboard();
                    if (window.showNotification) {
                        window.showNotification(`Switched to ${userRoles[role].name} role`, 'success');
                    }
                }
            };

            function updateDashboard() {
                const welcomeMessage = document.getElementById('welcome-message');
                if (welcomeMessage) {
                    const roleName = userRoles[currentUser.role]?.name || 'User';
                    welcomeMessage.textContent = `Welcome, Admin!`;
                }
            }

            // Create role switcher
            document.addEventListener('DOMContentLoaded', function() {
                const roleSwitcher = document.getElementById('role-switcher');
                if (roleSwitcher) {
                    roleSwitcher.classList.remove('hidden');
                    roleSwitcher.innerHTML = `
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-1">Role (Demo)</label>
                            <select id="role-selector" class="w-full px-2 py-1 text-sm bg-gray-700 border border-gray-600 rounded text-white focus:outline-none focus:ring-2 focus:ring-secondary">
                                ${Object.entries(userRoles).map(([key, role]) => 
                                    `<option value="${key}" ${key === currentUser.role ? 'selected' : ''}>${role.name}</option>`
                                ).join('')}
                            </select>
                        </div>
                    `;

                    document.getElementById('role-selector').addEventListener('change', function(e) {
                        window.setUserRole(e.target.value);
                    });
                }
                updateDashboard();
            });
        })();
    </script>
</body>
</html>